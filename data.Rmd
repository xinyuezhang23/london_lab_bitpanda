---
title: "bitpanda"
author: "Xinyue Zhang, Hanyu Wang"
date: "5/5/2022"
output: html_document
---

```{r setup, include=FALSE}
library(geckor)
library(tidyverse)
library(ggplot2)
library(magrittr)
```

```{r}
pantos_history <- coin_history(coin_id="pantos", 
                               vs_currency="usd", 
                               days = 'max', 
                               interval=NULL)

pantos_history<- pantos_history %>% mutate(market_cap= case_when(coin_id =="pantos" ~price* 486161689,TRUE ~ market_cap)) %>%
                                    mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100) %>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
polkadot_history <- coin_history(coin_id = "polkadot", 
                                vs_currency = "usd", 
                                days = "max",
                                interval = NULL)

polkadot_history<- polkadot_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
cosmos_history <- coin_history(coin_id = "cosmos", 
                                vs_currency = "usd", 
                                days= 'max',
                                interval = NULL)

cosmos_history<- cosmos_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
harmony_history <- coin_history(coin_id = "harmony", 
                                vs_currency = "usd", 
                                days= 'max',
                                interval = NULL)

harmony_history<- harmony_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
best_history <- coin_history(coin_id = "bitpanda-ecosystem-token", 
                                vs_currency = "usd", 
                                days= 'max',
                                interval = NULL)

best_history<- best_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
bnb_history <- coin_history(coin_id = "binancecoin", 
                                vs_currency = "usd", 
                                days= 'max',
                                interval = NULL)

bnb_history<- bnb_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```

```{r}
tcap_history <- coin_history(coin_id = "total-crypto-market-cap-token", 
                                vs_currency = "usd", 
                                days= 'max',
                                interval = NULL)

tcap_history<- tcap_history %>% mutate(net_ret = (price-lag(price))/lag(price) *100) %>%
                                    mutate(change_tv = (total_volume-lag(total_volume))/lag(total_volume) *100) %>%
                                    mutate(change_mc = (market_cap-lag(market_cap))/lag(market_cap) *100)%>%
                                    mutate(liquility = (total_volume/price))
```


```{r}
history<- rbind(pantos_history, polkadot_history, cosmos_history, harmony_history,
                best_history, bnb_history, tcap_history)
history
```
There are some infinite values and cuased error when saving into Google sheet.
```{r}
history[sapply(history, is.infinite)] <- NaN
```


```{r}
write.csv(history,file="history.csv")
```

# connect to Google sheet
```{r}
#code below only needs to be run once, it will guide you to connect to google account
library(googlesheets4)
library(googledrive)
options(gargle_oauth_cache = ".secrets")
drive_auth(cache = ".secrets", email = "hanyuwangofficial@gmail.com")# email="" change to your own Google account
gs4_auth(token = drive_token())

```



```{r}
history_gs<- gs4_create(
  "history", # file name
  sheets =history #data source
)
```

```{r}
write_sheet(history, ss = '1jeU0eiOnYAL4yhaZ0Ot9eRZ5HR4kXgyYZl4yPofPwcw', sheet = 'history')
```


```{r}
# history %>% 
#   #filter(coin_id %in% c("cosmos","harmony")) %>% 
#   ggplot()+
#   geom_line(aes(x=timestamp,y=price,color=coin_id))
      
```


